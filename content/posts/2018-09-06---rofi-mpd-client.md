---
date: "2018-09-06T16:54:40+09:00"
title: "Rofiを使って簡単なMPDクライアントを作った"
slug: rofi-mpd-client
description:
template: "post"
tags:
  - "Linux"
  - "i3wm"
draft: false
category: "Article"
redirect_from:
  - /2018/180906_rofi-mpd-client/180906_rofi-mpd-client/
---

タイトルのとおり。  
Repository: [rofi-mpd-client](https://github.com/tonooo71/rofi-mpd-client)

## Rofi

rofi は i3 のようなタイル型ウィンドウマネージャーでよく用いられているランチャーです。  
基本的な動作としては、選びたい項目を rofi に渡すとリストとして表示され、選択した項目(の文字列)を返すといったものです。

![Screenshot180906](/media/2018-09-06-screenshot180906.jpg)

よく使われているのは上のようにプログラムを選択するランチャーとしてですが、上記のように入力を手動で与えることができるので、色々活用方法が考えられます。  
実際に rofi の wiki ページにはユーザーが作成したスクリプトがいくつか紹介されています。([User scripts](https://github.com/DaveDavenport/rofi/wiki/User-scripts))

今回作った MPD のクライアントも 2 つ紹介されているのですが、自分がよく使う機能だったり欲しい機能だったりがなかったりしたので、作ってみることにしました。  
最初は例のごとくシェルスクリプトで作ろうと思ったのですが、挫折したのでおとなしく python3 で記述しました。  
MPD へアクセスするために上記のスクリプトではいずれも`mpc`という CLI クライアントを利用していたのですが、いちいち subprocess モジュールで呼び出すのもなんかなあって感じだったので、Python のモジュールないか探していたらありました。  
`python-musicpd`というモジュールです(数年前に更新がストップしていますが使うには問題ないです)。これはクライアントというよりはラッパーのようなものなので、`mpc`よりも柔軟に機能を呼び出せそうです。

## Rofi-mpd-client

で、実際できたものがこちらです。  
![rofi-mpd-client-top](/media/2018-09-06-rofi-mpd0.jpg)

![rofi-mpd-client-artist](/media/2018-09-06-rofi-mpd2.jpg)

![rofi-mpd-client-album](/media/2018-09-06-rofi-mpd2.jpg)

一番上は rofi おなじみの検索バーです。インクリメンタルサーチ可能です。  
2 列目は今再生している曲を表示します。またプレイリストにおける現在の位置も最後尾に表示します。  
そして選択リストでは、再生/停止コマンドと曲をプレイリストに追加します。私の環境ではアーティスト名/アルバム名/のようなフォルダ構造にしているので、MPD のインデックスにおける root の場所では追加できないようにしています。  
一応アルバムを選択すると曲まで表示しますが、曲を選択してもそれに対しては未実装なので何も起きません。

これ CLI ファイラーのように見えますが、rofi なのでなにか選択する毎に一旦 rofi は終了します。そして再び立ち上がる、といった動作をするのでチカチカします。

## メモ

フォルダ間を遷移させるために rofi を何回も起動させなければいけなかったので、

```python
while 1
    rofi.start()
```

みたいに書いていたら、rofi が終了できなくなって詰みかけました。(rofi が最前面に表示され、rofi への入力が最優先される仕様上、いかなるキーのタイプを受け付けないのが理由です)  
対策として rofi から返ってくる要素がない場合 while ループから脱出するようにしました。つまり Esc キーを押せば rofi はなんの要素も選択されることなく終了するので、rofi の無限ループは起こりません。
